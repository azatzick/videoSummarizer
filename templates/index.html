{% extends 'base.html' %}
{% block title %}Home · AI Blog Generator{% endblock %}

{% block content %}
<section class="grid lg:grid-cols-2 gap-8 items-start">
  <div class="rounded-3xl border border-white/60 bg-white/70 backdrop-blur p-6 shadow-soft">
    <div class="mb-6">
      <h2 class="text-2xl font-semibold tracking-tight bg-gradient-to-r from-fuchsia-600 to-violet-700 bg-clip-text text-transparent">Generate a Blog from YouTube</h2>
      <p class="text-gray-600 mt-1">Paste a YouTube URL. We’ll transcribe and transform it into a polished article.</p>
    </div>

    <div>
      <label for="youtubeLink" class="block text-sm font-medium text-gray-700 mb-2">YouTube Link</label>
      <div class="flex">
        <input id="youtubeLink" type="url" placeholder="https://www.youtube.com/watch?v=..." class="flex-grow p-3 border border-gray-200 rounded-l-xl focus:outline-none focus:ring-2 focus:ring-violet-500 bg-white/60" />
        <button id="generateBlogButton" class="px-5 rounded-r-xl btn-primary">Generate</button>
      </div>
      <p class="text-xs text-gray-500 mt-2">Your generated posts are saved to your account.</p>
    </div>

    <div id="loading-circle" class="hidden mt-6 inline-flex items-center gap-2 text-violet-700">
      <span class="loading-dot"></span>
      <span>Generating your article...</span>
    </div>
  </div>

  <div class="rounded-3xl border border-white/60 bg-white/70 backdrop-blur p-6 shadow-soft">
    <h3 class="text-xl font-semibold mb-3">Generated Article</h3>
    <div id="blogContent" class="prose prose-indigo max-w-none"></div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
const generateBtn = document.getElementById('generateBlogButton');
const linkInput = document.getElementById('youtubeLink');
const blogContent = document.getElementById('blogContent');
const loading = document.getElementById('loading-circle');

function showLoading(show) { loading.classList.toggle('hidden', !show); }

async function generate() {
  const link = linkInput.value.trim();
  if (!link) { alert('Please enter a YouTube link.'); return; }
  showLoading(true);
  blogContent.innerHTML = '';
  try {
    const res = await fetch('/generate-blog', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ link })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data?.error || 'Request failed');
    blogContent.innerHTML = data.content;
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
  } catch (e) { alert(e.message || 'Something went wrong.'); }
  finally { showLoading(false); }
}

generateBtn.addEventListener('click', (e) => { e.preventDefault(); generate(); });
linkInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); generate(); } });
</script>
{% endblock %}