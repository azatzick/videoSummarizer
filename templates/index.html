{% extends 'base.html' %}
{% block title %}Home · AI Blog Generator{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto bg-white p-6 rounded-lg shadow-md">
  <div class="text-center">
    <h2 class="text-2xl font-semibold mb-2">Generate a Blog from a YouTube Video</h2>
    <p class="text-gray-600">Paste a YouTube URL and we will transcribe and convert it to a well‑structured article.</p>
  </div>

  <div class="mt-6">
    <label for="youtubeLink" class="block text-sm font-medium text-gray-700 mb-1">YouTube Link</label>
    <div class="flex">
      <input id="youtubeLink" type="url" placeholder="https://www.youtube.com/watch?v=..." class="flex-grow p-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
      <button id="generateBlogButton" class="bg-blue-600 text-white px-4 py-2 rounded-r-md hover:bg-blue-700">Generate</button>
    </div>
    <p class="text-xs text-gray-500 mt-1">We store your generated posts to your account.</p>
  </div>

  <div id="loading-circle" class="hidden flex items-center gap-2 text-blue-700 mt-6">
    <svg class="animate-spin h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg>
    Generating your article...
  </div>

  <section class="mt-8">
    <h3 class="text-xl font-semibold mb-3">Generated Article</h3>
    <div id="blogContent" class="prose prose-sm sm:prose lg:prose-lg max-w-none"></div>
  </section>
</div>
{% endblock %}

{% block scripts %}
<script>
const generateBtn = document.getElementById('generateBlogButton');
const linkInput = document.getElementById('youtubeLink');
const blogContent = document.getElementById('blogContent');
const loading = document.getElementById('loading-circle');

function showLoading(show) {
  loading.classList.toggle('hidden', !show);
}

async function generate() {
  const link = linkInput.value.trim();
  if (!link) { alert('Please enter a YouTube link.'); return; }
  showLoading(true);
  blogContent.innerHTML = '';
  try {
    const res = await fetch('/generate-blog', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ link })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data?.error || 'Request failed');
    blogContent.innerHTML = data.content;
  } catch (e) {
    alert(e.message || 'Something went wrong.');
  } finally {
    showLoading(false);
  }
}

generateBtn.addEventListener('click', (e) => { e.preventDefault(); generate(); });
linkInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); generate(); } });
</script>
{% endblock %}